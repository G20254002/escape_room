<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNQAUR MUSEUM - íƒˆì¶œ ê²Œì„</title>
    <style>
        /* ì´ì „ê³¼ ë™ì¼í•œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body, html { margin: 0; padding: 0; font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif; background-color: #1a1a1a; }
        #start-screen { display: flex; justify-content: center; align-items: center; text-align: center; height: 100vh; background-color: #000; padding: 20px; box-sizing: border-box; background-image: url('dinosaur_museum_entrance.jpg'); background-size: cover; background-position: center; }
        .start-container { max-width: 1000px; width: 100%; background-color: rgba(0,0,0,0.5); padding: 40px; border-radius: 10px; }
        .intro-form form { display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap; }
        .input-group { display: flex; align-items: center; gap: 8px; }
        .intro-form label { font-size: 1.1em; color: #ccc; }
        .intro-form input { background-color: #333; border: 1px solid #555; color: #fff; padding: 8px 10px; border-radius: 4px; font-size: 1em; width: 80px; }
        .intro-form button { background-color: #a52a2a; color: #fff; border: none; padding: 10px 22px; border-radius: 5px; font-size: 1.1em; cursor: pointer; transition: background-color 0.3s; }
        #game-screen { display: none; color: #e0e0e0; }
        .game-header { position: sticky; top: 0; left: 0; width: 100%; background-color: rgba(20, 20, 20, 0.9); backdrop-filter: blur(5px); padding: 10px 20px; box-sizing: border-box; display: flex; justify-content: space-between; align-items: center; z-index: 1000; border-bottom: 1px solid #444; }
        .player-info { font-size: 0.9em; color: #ccc; }
        #timer { font-size: 1.8em; font-weight: bold; color: #ffffff; background-color: #4CAF50; padding: 5px 15px; border-radius: 5px; }
        .stadium-container { max-width: 900px; margin: 20px auto; border: 1px solid #444; border-radius: 10px; overflow: hidden; background-color: #2c2c2c; }
        .stage { display: none; padding: 25px; }
        .stage-title { font-size: 2em; color: #ffffff; border-bottom: 2px solid #a52a2a; padding-bottom: 10px; margin-bottom: 15px; }
        .stage-instruction { color: #ccc; margin-bottom: 20px; text-align: center; }
        .image-container { position: relative; width: 100%; margin-bottom: 20px; }
        .stage-image { display: block; width: 100%; height: auto; border-radius: 8px; }
        .hotspot { position: absolute; width: 40px; height: 40px; background-color: rgba(255, 223, 0, 0.5); border: 2px solid rgba(255, 255, 255, 0.7); border-radius: 50%; cursor: pointer; transition: all 0.3s ease; transform: translate(-50%, -50%); animation: pulse 2s infinite; }
        .hotspot.solved { background-color: rgba(76, 175, 80, 0.7); border-color: #4CAF50; animation: none; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 223, 0, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 223, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 223, 0, 0); } }
        .exit-puzzle { background-color: #333; border: 1px solid #555; border-left: 5px solid #a52a2a; padding: 20px; margin-top: 30px; border-radius: 5px; text-align: center; }
        .exit-puzzle h3 { font-size: 1.4em; color: #ffffff; margin-top: 0; }
        .exit-puzzle p { color: #ccc; }
        .exit-puzzle input { font-size: 1.5em; padding: 10px; width: 200px; text-align: center; background-color: #222; border: 1px solid #555; color: #fff; border-radius: 4px; margin: 10px 0; }
        .exit-puzzle button { background-color: #4a90e2; color: white; padding: 10px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.2em; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background-color: #3a3a3a; padding: 30px; border-radius: 10px; width: 90%; max-width: 500px; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.5); text-align: center; }
        .modal-close { position: absolute; top: 10px; right: 15px; font-size: 2em; line-height: 1; cursor: pointer; color: #aaa; }
        #modal-title { font-size: 1.8em; color: #a52a2a; margin-top: 0; margin-bottom: 20px; }
        #modal-game-content { margin-bottom: 25px; user-select: none; }
        .card-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .card { width: 100%; height: 80px; background-color: #555; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 2em; color: transparent; transition: all 0.3s; transform-style: preserve-3d; }
        .card.flipped, .card.matched { background-color: #777; transform: rotateY(180deg); color: #fff; }
        .dodger-game { position: relative; height: 300px; background-color: #222; border: 2px solid #555; overflow: hidden; }
        .player { position: absolute; width: 30px; height: 30px; background-color: #4CAF50; border-radius: 50%; bottom: 10px; }
        .obstacle { position: absolute; width: 20px; height: 20px; background-color: #d9534f; top: -20px; }
        
        /* <<< í•µì‹¬ ìˆ˜ì • 1: ë‹¨ì„œ í™•ì¸ìš© ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .clue-display {
            background-color: #2c2c2c;
            border: 1px solid #444;
            padding: 20px;
            border-radius: 5px;
        }
        .clue-display p {
            font-size: 1.1em;
            color: #ccc;
            margin: 0 0 10px 0;
        }
        .clue-display strong {
            font-size: 1.5em;
            color: #ffdd00;
        }
    </style>
</head>
<body>

    <!-- HTML êµ¬ì¡°ëŠ” ë³€ê²½ ì—†ìŒ -->
    <div id="start-screen">
        <div class="start-container">
            <div class="intro-form">
                <form id="start-form">
                    <div class="input-group"><label for="grade">í•™ë…„</label><input type="text" id="grade" name="grade" required></div>
                    <div class="input-group"><label for="class">ë°˜</label><input type="text" id="class" name="class" required></div>
                    <div class="input-group"><label for="name">ì´ë¦„</label><input type="text" id="name" name="name" style="width: 80px;" required></div>
                    <button type="submit">ì…ì¥í•˜ê¸°</button>
                </form>
            </div>
        </div>
    </div>
    <div id="game-screen">
        <header class="game-header">
            <div class="player-info">
                <span id="player-grade"></span>í•™ë…„ 
                <span id="player-class"></span>ë°˜ 
                <span id="player-name"></span>
            </div>
            <div id="timer">00:00</div>
        </header>
        <div class="stadium-container">
            <div class="stage" id="stage-1">
                <h2 class="stage-title">1ë‹¨ê³„: ì¤‘ì•™ í™€</h2>
                <p class="stage-instruction">ì´ë¯¸ì§€ ì† ë¹›ë‚˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ í´ë¦­í•˜ì—¬ ë¯¸ë‹ˆê²Œì„ì„ í•´ê²°í•˜ì„¸ìš”.</p>
                <div class="image-container">
                    <img src="dinosaur_museum_1.jpg" alt="ì¤‘ì•™ í™€" class="stage-image">
                    <div class="hotspot" id="hotspot-game1-1" style="top: 85%; left: 20%;" onclick="openModal('game1-1')"></div>
                    <div class="hotspot" id="hotspot-game1-2" style="top: 88%; left: 75%;" onclick="openModal('game1-2')"></div>
                    <div class="hotspot" id="hotspot-game1-3" style="top: 20%; left: 50%;" onclick="openModal('game1-3')"></div>
                    <div class="hotspot" id="hotspot-game1-4" style="top: 65%; left: 8%;" onclick="openModal('game1-4')"></div>
                </div>
                <div class="exit-puzzle">
                    <h3>ì—°êµ¬ì‹¤ ì¶œì…ë¬¸</h3>
                    <p>ëª¨ë“  ë‹¨ì„œë¥¼ ì¡°í•©í•˜ì—¬ 4ìë¦¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                    <input type="text" id="exit-input-1" placeholder="####" maxlength="4">
                    <button onclick="attemptExit(1)">ì ê¸ˆ í•´ì œ</button>
                </div>
            </div>
            <div class="stage" id="stage-2">
                <h2 class="stage-title">2ë‹¨ê³„: í™”ì„ ì—°êµ¬ì‹¤</h2>
                <p class="stage-instruction">ì–´ì§€ëŸ¬ìš´ ì—°êµ¬ì‹¤ì„ ì¡°ì‚¬í•˜ì—¬ ë°•ì‚¬ì˜ í”ì ì„ ì°¾ìœ¼ì„¸ìš”.</p>
                <div class="image-container">
                    <img src="dinosaur_lab.jpg" alt="í™”ì„ ì—°êµ¬ì‹¤" class="stage-image">
                    <div class="hotspot" id="hotspot-game2-1" style="top: 30%; left: 80%;" onclick="openModal('game2-1')"></div>
                    <div class="hotspot" id="hotspot-game2-2" style="top: 75%; left: 25%;" onclick="openModal('game2-2')"></div>
                    <div class="hotspot" id="hotspot-game2-3" style="top: 60%; left: 55%;" onclick="openModal('game2-3')"></div>
                    <div class="hotspot" id="hotspot-game2-4" style="top: 50%; left: 85%;" onclick="openModal('game2-4')"></div>
                </div>
                <div class="exit-puzzle">
                    <h3>ìµë£¡ê´€ ë¹„ìƒë¬¸</h3>
                    <p>ì»´í“¨í„°ì— ë°•ì‚¬ê°€ ìˆ¨ê²¨ë‘” ë§ˆì§€ë§‰ ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                    <input type="text" id="exit-input-2" placeholder="ë‹¨ì–´ ì…ë ¥">
                    <button onclick="attemptExit(2)">ì ‘ì†</button>
                </div>
            </div>
            <div class="stage" id="stage-3">
                <h2 class="stage-title">3ë‹¨ê³„: ìµë£¡ê´€</h2>
                <p class="stage-instruction">í•˜ëŠ˜ì„ ë‚˜ëŠ” íŒŒì¶©ë¥˜ë“¤ ì‚¬ì´ì—ì„œ ë§ˆì§€ë§‰ íƒˆì¶œêµ¬ë¥¼ ì°¾ìœ¼ì„¸ìš”.</p>
                <div class="image-container">
                    <img src="pterosaur_hall.jpg" alt="ìµë£¡ê´€" class="stage-image">
                    <div class="hotspot" id="hotspot-game3-1" style="top: 50%; left: 10%;" onclick="openModal('game3-1')"></div>
                    <div class="hotspot" id="hotspot-game3-2" style="top: 55%; left: 90%;" onclick="openModal('game3-2')"></div>
                    <div class="hotspot" id="hotspot-game3-3" style="top: 25%; left: 50%;" onclick="openModal('game3-3')"></div>
                    <div class="hotspot" id="hotspot-game3-4" style="top: 80%; left: 50%;" onclick="openModal('game3-4')"></div>
                </div>
                <div class="exit-puzzle">
                    <h3>ë°•ë¬¼ê´€ ë¹„ìƒ íƒˆì¶œêµ¬</h3>
                    <p>ëª¨ë“  ë‹¨ì„œë¥¼ ì¡°í•©í•˜ì—¬ íƒˆì¶œ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                    <input type="text" id="exit-input-3" placeholder="ì•”í˜¸ ì…ë ¥">
                    <button onclick="attemptExit(3)">íƒˆì¶œ</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="mini-game-modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">Ã—</span>
            <h2 id="modal-title"></h2>
            <div id="modal-game-content"></div>
        </div>
    </div>

    <script>
        // --- ê²Œì„ ìƒíƒœ ê´€ë¦¬ ë³€ìˆ˜ ---
        let currentStage = 1;
        let timerInterval = null;
        let gameInterval = null;
        const totalStages = 3;
        const stageSolutions = { 1: '4725', 2: 'RESEARCH', 3: 'EXIT' };

        const originalQuizPool = [
            { question: "ì„¸ìƒì—ì„œ ê°€ì¥ ëœ¨ê±°ìš´ ê³¼ì¼ì€?", answer: "ì²œë„ë³µìˆ­ì•„" },
            { question: "ì™•ì´ ë„˜ì–´ì§€ë©´ ë­ê°€ ë ê¹Œ?", answer: "í‚¹ì½©" },
            { question: "ì„¸ìƒì—ì„œ ê°€ì¥ ì°©í•œ ì‚¬ìëŠ”?", answer: "ìì›ë´‰ì‚¬ì" },
            { question: "ì„¸ìƒì—ì„œ ê°€ì¥ ì§€ë£¨í•œ ì¤‘í•™êµëŠ”?", answer: "ë¡œë”©ì¤‘" },
            { question: "ìë™ì°¨ë¥¼ í†¡í•˜ê³  ì¹˜ë©´?", answer: "ì¹´í†¡" },
            { question: "ì‚¬ëŒì˜ ëª¸ë¬´ê²Œê°€ ê°€ì¥ ë§ì´ ë‚˜ê°ˆ ë•ŒëŠ”?", answer: "ì² ë“¤ë•Œ" }
        ];
        let quizPool = [...originalQuizPool];

        // --- ì¬ì‚¬ìš©í•  ë¯¸ë‹ˆê²Œì„ í•¨ìˆ˜ë“¤ (ë³€ê²½ ì—†ìŒ) ---
        function setupCardGame(gameId) {
            const content = document.getElementById('modal-game-content');
            const symbols = ['ğŸ¦´', 'ğŸ¦´', 'ğŸ¥š', 'ğŸ¥š', 'ğŸŒ¿', 'ğŸŒ¿', 'ğŸŒ‹', 'ğŸŒ‹'].sort(() => 0.5 - Math.random());
            let flippedCards = [];
            let matchedPairs = 0;
            content.innerHTML = '<div class="card-grid"></div>';
            const grid = content.querySelector('.card-grid');
            symbols.forEach(symbol => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.symbol = symbol;
                card.textContent = symbol;
                grid.appendChild(card);
                card.addEventListener('click', () => {
                    if (flippedCards.length < 2 && !card.classList.contains('flipped')) {
                        card.classList.add('flipped');
                        flippedCards.push(card);
                        if (flippedCards.length === 2) {
                            setTimeout(() => {
                                if (flippedCards[0].dataset.symbol === flippedCards[1].dataset.symbol) {
                                    flippedCards.forEach(c => c.classList.add('matched'));
                                    matchedPairs++;
                                    if (matchedPairs === symbols.length / 2) winGame(gameId);
                                } else {
                                    flippedCards.forEach(c => c.classList.remove('flipped'));
                                }
                                flippedCards = [];
                            }, 1000);
                        }
                    }
                });
            });
        }
        function setupRPSGame(gameId) {
            const content = document.getElementById('modal-game-content');
            content.innerHTML = `
                <p>ì»´í“¨í„°ë¥¼ ìƒëŒ€ë¡œ ê°€ìœ„ë°”ìœ„ë³´ì—ì„œ ìŠ¹ë¦¬í•˜ì„¸ìš”!</p>
                <button>ê°€ìœ„ âœŒï¸</button> <button>ë°”ìœ„ âœŠ</button> <button>ë³´ ğŸ–ï¸</button>
                <p id="rps-result"></p>
            `;
            const buttons = content.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    const choices = ['ê°€ìœ„', 'ë°”ìœ„', 'ë³´'];
                    const userChoice = button.textContent.split(' ')[0];
                    const computerChoice = choices[Math.floor(Math.random() * 3)];
                    const resultEl = document.getElementById('rps-result');
                    let resultText = `ì‚¬ìš©ì: ${userChoice}, ì»´í“¨í„°: ${computerChoice}. `;
                    if (userChoice === computerChoice) {
                        resultText += 'ë¹„ê²¼ìŠµë‹ˆë‹¤. ë‹¤ì‹œ í•˜ì„¸ìš”!';
                    } else if (
                        (userChoice === 'ê°€ìœ„' && computerChoice === 'ë³´') ||
                        (userChoice === 'ë°”ìœ„' && computerChoice === 'ê°€ìœ„') ||
                        (userChoice === 'ë³´' && computerChoice === 'ë°”ìœ„')
                    ) {
                        resultText += 'ì´ê²¼ìŠµë‹ˆë‹¤!';
                        winGame(gameId);
                    } else {
                        resultText += 'ì¡ŒìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”!';
                    }
                    resultEl.textContent = resultText;
                });
            });
        }
        function setupQuizGame(gameId) {
            if (quizPool.length === 0) {
                quizPool = [...originalQuizPool];
            }
            const randomIndex = Math.floor(Math.random() * quizPool.length);
            const selectedQuiz = quizPool.splice(randomIndex, 1)[0];
            const content = document.getElementById('modal-game-content');
            content.innerHTML = `
                <p>ë¬¸ì œ: ${selectedQuiz.question}</p>
                <input type="text" id="quiz-input" placeholder="ì •ë‹µ ì…ë ¥">
                <button>í™•ì¸</button>
            `;
            content.querySelector('button').addEventListener('click', () => {
                const answer = content.querySelector('input').value;
                if (answer.includes(selectedQuiz.answer)) {
                    winGame(gameId);
                } else {
                    alert('í‹€ë ¸ìŠµë‹ˆë‹¤!');
                }
            });
        }
        function setupDodgerGame(gameId) {
            const content = document.getElementById('modal-game-content');
            content.innerHTML = `<p>10ì´ˆ ë™ì•ˆ ìš´ì„ì„ í”¼í•˜ì„¸ìš”!</p><div class="dodger-game"><div class="player"></div></div>`;
            const gameArea = content.querySelector('.dodger-game');
            const player = content.querySelector('.player');
            let survivalTime = 0;
            let obstacleIntervals = [];
            const stopAllIntervals = () => {
                clearInterval(gameInterval);
                obstacleIntervals.forEach(clearInterval);
                gameInterval = null;
            };
            gameArea.addEventListener('mousemove', e => {
                const rect = gameArea.getBoundingClientRect();
                let x = e.clientX - rect.left - (player.offsetWidth / 2);
                x = Math.max(0, Math.min(x, gameArea.offsetWidth - player.offsetWidth));
                player.style.left = x + 'px';
            });
            gameInterval = setInterval(() => {
                const obstacle = document.createElement('div');
                obstacle.classList.add('obstacle');
                obstacle.style.left = Math.random() * (gameArea.offsetWidth - 20) + 'px';
                gameArea.appendChild(obstacle);
                let obstacleInterval = setInterval(() => {
                    if (!gameInterval) {
                        clearInterval(obstacleInterval);
                        obstacle.remove();
                        return;
                    }
                    const top = obstacle.offsetTop;
                    if (top > gameArea.offsetHeight) {
                        obstacle.remove();
                        clearInterval(obstacleInterval);
                    } else {
                        obstacle.style.top = top + 5 + 'px';
                        const pRect = player.getBoundingClientRect();
                        const oRect = obstacle.getBoundingClientRect();
                        if (!(pRect.right < oRect.left || pRect.left > oRect.right || pRect.bottom < oRect.top || pRect.top > oRect.bottom)) {
                            stopAllIntervals();
                            alert('ì¶©ëŒ! ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”.');
                            closeModal(); 
                        }
                    }
                }, 20);
                obstacleIntervals.push(obstacleInterval);
                survivalTime++;
                if (survivalTime >= 10) {
                    stopAllIntervals();
                    winGame(gameId);
                }
            }, 1000);
        }

        // --- ë¯¸ë‹ˆê²Œì„ ë°ì´í„° ê°ì²´ (ë³€ê²½ ì—†ìŒ) ---
        const miniGames = {
            'game1-1': { title: 'ì¹´ë“œ ë’¤ì§‘ê¸°', clue: 'íšë“í•œ ë‹¨ì„œ: [ì²« ë²ˆì§¸ ìˆ«ì: 4]', solved: false, setupFunction: setupCardGame },
            'game1-2': { title: 'ê°€ìœ„ë°”ìœ„ë³´', clue: 'íšë“í•œ ë‹¨ì„œ: [ë‘ ë²ˆì§¸ ìˆ«ì: 7]', solved: false, setupFunction: setupRPSGame },
            'game1-3': { title: 'ë„Œì„¼ìŠ¤ í€´ì¦ˆ', type: 'quiz', clue: 'íšë“í•œ ë‹¨ì„œ: [ì„¸ ë²ˆì§¸ ìˆ«ì: 2]', solved: false, setupFunction: setupQuizGame },
            'game1-4': { title: 'ìš´ì„ í”¼í•˜ê¸°', clue: 'íšë“í•œ ë‹¨ì„œ: [ë„¤ ë²ˆì§¸ ìˆ«ì: 5]', solved: false, setupFunction: setupDodgerGame },
            'game2-1': { title: 'ë„Œì„¼ìŠ¤ í€´ì¦ˆ', type: 'quiz', clue: 'íšë“í•œ ë‹¨ì„œ: [ê¸€ì: R, E]', solved: false, setupFunction: setupQuizGame },
            'game2-2': { title: 'ì¹´ë“œ ë’¤ì§‘ê¸°', clue: 'íšë“í•œ ë‹¨ì„œ: [ê¸€ì: S, E]', solved: false, setupFunction: setupCardGame },
            'game2-3': { title: 'ìš´ì„ í”¼í•˜ê¸°', clue: 'íšë“í•œ ë‹¨ì„œ: [ê¸€ì: A, R]', solved: false, setupFunction: setupDodgerGame },
            'game2-4': { title: 'ê°€ìœ„ë°”ìœ„ë³´', clue: 'íšë“í•œ ë‹¨ì„œ: [ê¸€ì: C, H]', solved: false, setupFunction: setupRPSGame },
            'game3-1': { title: 'ê°€ìœ„ë°”ìœ„ë³´', clue: 'íšë“í•œ ë‹¨ì„œ: [ì²« ê¸€ì: E]', solved: false, setupFunction: setupRPSGame },
            'game3-2': { title: 'ìš´ì„ í”¼í•˜ê¸°', clue: 'íšë“í•œ ë‹¨ì„œ: [ë‘ ë²ˆì§¸ ê¸€ì: X]', solved: false, setupFunction: setupDodgerGame },
            'game3-3': { title: 'ì¹´ë“œ ë’¤ì§‘ê¸°', clue: 'íšë“í•œ ë‹¨ì„œ: [ì„¸ ë²ˆì§¸ ê¸€ì: I]', solved: false, setupFunction: setupCardGame },
            'game3-4': { title: 'ë„Œì„¼ìŠ¤ í€´ì¦ˆ', type: 'quiz', clue: 'íšë“í•œ ë‹¨ì„œ: [ë§ˆì§€ë§‰ ê¸€ì: T]', solved: false, setupFunction: setupQuizGame },
        };

        // --- ë‚˜ë¨¸ì§€ JavaScript ë¡œì§ ---
        document.getElementById('start-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const grade = document.getElementById('grade').value;
            const className = document.getElementById('class').value;
            const name = document.getElementById('name').value;
            document.getElementById('player-grade').textContent = grade;
            document.getElementById('player-class').textContent = className;
            document.getElementById('player-name').textContent = name;
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            document.getElementById('stage-1').style.display = 'block';
            startTimer(); 
        });

        const modal = document.getElementById('mini-game-modal');
        const modalTitle = document.getElementById('modal-title');
        const gameContent = document.getElementById('modal-game-content');

        // <<< í•µì‹¬ ìˆ˜ì • 2: openModal í•¨ìˆ˜ ë¡œì§ ë³€ê²½
        function openModal(gameId) {
            const gameData = miniGames[gameId];
            
            if (gameData.solved) {
                // ì´ë¯¸ í•´ê²°í•œ ë¬¸ì œì¼ ê²½ìš°, ë‹¨ì„œë¥¼ ë³´ì—¬ì£¼ëŠ” ëª¨ë‹¬ì„ ë„ì›€
                modalTitle.textContent = gameData.title + " - ë‹¨ì„œ í™•ì¸";
                gameContent.innerHTML = `
                    <div class="clue-display">
                        <p>ì´ê³³ì—ì„œ ë‹¤ìŒ ë‹¨ì„œë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤:</p>
                        <strong>${gameData.clue}</strong>
                    </div>
                `;
            } else {
                // í•´ê²°í•˜ì§€ ì•Šì€ ë¬¸ì œì¼ ê²½ìš°, ë¯¸ë‹ˆê²Œì„ì„ ì‹¤í–‰
                modalTitle.textContent = gameData.title;
                gameData.setupFunction(gameId);
            }
            modal.style.display = 'flex';
        }

        function closeModal() {
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
            modal.style.display = 'none';
            gameContent.innerHTML = '';
        }

        function winGame(gameId) {
            const gameData = miniGames[gameId];
            if (!gameData.solved) {
                setTimeout(() => {
                    // ë„Œì„¼ìŠ¤ í€´ì¦ˆëŠ” ë‹¨ì„œ ì—†ì´ ì„±ê³µ ë©”ì‹œì§€ë§Œ ë³´ì—¬ì¤Œ
                    if (gameData.type === 'quiz') {
                        alert('ì •ë‹µì…ë‹ˆë‹¤!');
                    } else {
                        alert(gameData.clue);
                    }
                    gameData.solved = true;
                    document.getElementById('hotspot-' + gameId).classList.add('solved');
                    closeModal();
                }, 100);
            }
        }

        function attemptExit(stageNum) {
            if (stageNum !== currentStage) return;
            if (!areAllGamesSolved(stageNum)) {
                alert('ì•„ì§ ëª¨ë“  ë‹¨ì„œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì£¼ë³€ì„ ë” íƒìƒ‰í•´ë³´ì„¸ìš”!');
                return;
            }
            const userInput = document.getElementById('exit-input-' + stageNum).value;
            const solution = stageSolutions[stageNum];
            if (userInput.toUpperCase() === solution.toUpperCase()) {
                alert('ì •ë‹µì…ë‹ˆë‹¤! ë¬¸ì´ ì—´ë¦½ë‹ˆë‹¤.');
                document.getElementById('stage-' + currentStage).style.display = 'none';
                currentStage++;
                if (currentStage > totalStages) {
                    clearInterval(timerInterval);
                    const finalTime = document.getElementById('timer').textContent;
                    alert(`ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ë‹¨ê³„ë¥¼ í´ë¦¬ì–´í•˜ê³  íƒˆì¶œì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!\n\nìµœì¢… ê¸°ë¡: ${finalTime}`);
                    document.getElementById('timer').textContent = "íƒˆì¶œ ì„±ê³µ!";
                } else {
                    document.getElementById('stage-' + currentStage).style.display = 'block';
                }
            } else {
                alert('í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¨ì„œë“¤ì„ ë‹¤ì‹œ ì¡°í•©í•´ë³´ì„¸ìš”.');
            }
        }

        function areAllGamesSolved(stageNum) {
            for (const gameId in miniGames) {
                if (gameId.startsWith('game' + stageNum)) {
                    if (!miniGames[gameId].solved) return false;
                }
            }
            return true;
        }

        function startTimer() {
            let timer = 0;
            const timerDisplay = document.getElementById('timer');
            timerInterval = setInterval(() => {
                timer++;
                let minutes = Math.floor(timer / 60);
                let seconds = timer % 60;
                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;
                timerDisplay.textContent = minutes + ":" + seconds;
            }, 1000);
        }
    </script>

</body>
</html>